(function(e){function n(t){var n=t.book,r=t.chapter,i=t.verse,s=r-1,o=i-1,u=!1,a='<div class="reference" data-book="'+n+'" data-chapter="'+r+'"><h1>'+n+" "+r+"</h1>";a+='<ol class="wrapper">';var f,l;if(hebrewObject[n]){f=hebrewObject;l="hebrew"}else{f=greekObject;l="greek"}e.each(bibleObject[n][s],function(t,i){a+='<li id="'+n.replace(/ /gi,"_")+"_"+r+"_"+(t+1)+'">';a+='<div class="wrapper"';t===o&&(a+=' id="current"');if(t===o-5){a+=' id="context"';u=!0}a+=">";a+='<div class="english">';e.each(bibleObject[n][s][t],function(e,t){a+=createWordString(t,l)});a+="</div>";if(f[n]&&f[n][s][t]){a+="<div class='original "+l+"'>";e.each(f[n][s][t],function(e,t){a+=createWordString(t,l)});a+="</div>"}a+="</div>";a+="</li>"});a+="</ol>";a+="</div>";return a}function r(t,n){var r=t.book,i=t.chapter,s={},o=parseInt(i,10)+n,u=o-1,a;if(bibleObject[r]&&bibleObject[r][u]!==undefined){s.book=r;s.chapter=o}else e.each(bible.Data.books,function(e,t){if(t[0]===r){a=e+n;if(bible.Data.books[a]!==undefined){s.book=bible.Data.books[a][0];n>0?s.chapter=1:s.chapter=bible.Data.verses[a].length}}});return s}function i(){var n=window.location.hash;if(n.indexOf("search")>-1){var r=n.split("=")[1];searchByStrongsNumber(r)}else{var i=n.split("&");if(i){var s=i[0].split("=")[1],o=parseInt(i[1].split("=")[1]);if(i[2])var u=parseInt(i[2].split("=")[1]);else u=1;t.load({book:s,chapter:o,verse:u}).scrollToVerse(e("#current"))}}}e.fn.scrollStopped=function(t){e(this).scroll(function(){var n=this,r=e(n);r.data("scrollTimeout")&&clearTimeout(r.data("scrollTimeout"));r.data("scrollTimeout",setTimeout(t,250,n))})};var t={load:function(t){var i=t.book,s=t.chapter,o=t.verse;undefined===o&&(t.verse=1);e("head title").text(i+" "+s+":"+o);var u=e('<div class="three-references" />'),a=r(t,-1),f=r(t,1);if(a.book){u.data("prev",a);u.append(n(a))}u.append(n(t));if(f.book){u.data("next",f);u.append(n(f))}e.fn.waypoint&&e(".reference").waypoint("destroy");e("#verse").html(u);maintainState(i,s,o);return this},scrollToVerse:function(t,n){undefined===n&&(n=0);e("#verse").closest(".panel").scrollTop(0);t.length>0&&e("#verse").closest(".panel").scrollTo(t,{offset:n});e(document).trigger("createWayPoint")},getAnchoringData:function(t){var n="#current",r=0,i=e("body").scrollTop(),s;if(t){t==="prev"&&(s=e(".reference:first-child ol.wrapper li:first-child"));t==="next"&&(s=e(".reference:last-child ol.wrapper li:last-child"));n="#"+s.attr("id");r=i-s.offset().top- -e(".dock").height()}return[r,n]},anchorReference:function(t){var n=t[1],r=t[0],i=e(n);n===".current-verse"&&(verseHeight=i.height(),r=-e(window).height()/2+verseHeight);if(i.length===0){i=e("#"+jsonCollection.currentId);r=-e("[data-role=header]").height()}this.scrollToVerse(i,r)}};i();e(window).bind("hashchange",function(e){var t=new Date;i();var n=new Date;timer(t,n)});e("#reference").scrollStopped(function(){var n=e(".dock").height()-e("#verse").offset().top,r=e("#verse").height()-e(window).height()+e(".dock").height();if(n<=0){var i=e(".three-references").data("prev"),s=t.getAnchoringData("prev");t.load(i).anchorReference(s)}if(n>=r){var o=e(".three-references").data("next"),s=t.getAnchoringData("next");t.load(o).anchorReference(s)}});e(".goToReference").submit(function(t){t.preventDefault();console.log(e("#goToReference").val());var n=bible.parseReference(e("#goToReference").val()),r="book="+bible.Data.books[n.bookID-1][0]+"&chapter="+n.chapter+"&verse="+n.verse;console.log(r);window.location.hash=r;e(this).closest(".popup").popup("close");return!1})})(jQuery);